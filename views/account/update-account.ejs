<%- include('../partials/header') %>
<main class="account-update">
  <h1>Update Account</h1>
  
  <% if (messages.notice) { %>
    <div class="notice"><%= messages.notice %></div>
  <% } %>
  
  <!-- Account Update Form -->
  <section class="account-update-form">
    <h2>Account Update</h2>
    <form action="/account/update" method="post" id="accountUpdateForm">
      <input type="hidden" name="account_id" value="<%= accountData.account_id %>">
      
      <div class="form-group">
        <label for="account_firstname">First Name:</label>
        <input 
          type="text" 
          id="account_firstname" 
          name="account_firstname" 
          value="<%= accountData.account_firstname || '' %>" 
          required
          minlength="2"
          maxlength="50"
        >
        <div class="error-message" id="firstNameError"></div>
      </div>
      
      <div class="form-group">
        <label for="account_lastname">Last Name:</label>
        <input 
          type="text" 
          id="account_lastname" 
          name="account_lastname" 
          value="<%= accountData.account_lastname || '' %>" 
          required
          minlength="2"
          maxlength="50"
        >
        <div class="error-message" id="lastNameError"></div>
      </div>
      
      <div class="form-group">
        <label for="account_email">Email:</label>
        <input 
          type="email" 
          id="account_email" 
          name="account_email" 
          value="<%= accountData.account_email || '' %>" 
          required
          maxlength="100"
        >
        <div class="error-message" id="emailError"></div>
      </div>
      
      <button type="submit" class="btn">Update Account</button>
    </form>
  </section>
  
  <!-- Change Password Form -->
  <section class="password-update-form">
    <h2>Change Password</h2>
    <form action="/account/update-password" method="post" id="passwordUpdateForm">
      <input type="hidden" name="account_id" value="<%= accountData.account_id %>">
      
      <div class="form-group">
        <label for="account_password">Current Password:</label>
        <input 
          type="password" 
          id="account_password" 
          name="account_password" 
          required
        >
        <div class="error-message" id="currentPasswordError"></div>
      </div>
      
      <div class="form-group">
        <label for="account_new_password">New Password:</label>
        <input 
          type="password" 
          id="account_new_password" 
          name="account_new_password" 
          required
          minlength="8"
          pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$"
          title="Password must be at least 8 characters long and contain at least one uppercase letter, one lowercase letter, one number, and one special character."
        >
        <div class="form-help">
          Password must be at least 8 characters long and contain:
          <ul>
            <li>One uppercase letter</li>
            <li>One lowercase letter</li>
            <li>One number</li>
            <li>One special character (@$!%*?&)</li>
          </ul>
        </div>
        <div class="error-message" id="newPasswordError"></div>
      </div>
      
      <div class="form-group">
        <label for="account_confirm_password">Confirm New Password:</label>
        <input 
          type="password" 
          id="account_confirm_password" 
          name="account_confirm_password" 
          required
        >
        <div class="error-message" id="confirmPasswordError"></div>
      </div>
      
      <button type="submit" class="btn">Change Password</button>
    </form>
  </section>
  
  <p><a href="/account/" class="back-link">‚Üê Back to Account Management</a></p>
</main>

<!-- Client-side Validation Script -->
<script>
  // Account Update Form Validation
  document.getElementById('accountUpdateForm').addEventListener('submit', function(e) {
    let valid = true;
    
    // Clear previous errors
    document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
    
    // Validate First Name
    const firstName = document.getElementById('account_firstname');
    if (!firstName.value.trim()) {
      document.getElementById('firstNameError').textContent = 'First name is required.';
      valid = false;
    } else if (firstName.value.length < 2) {
      document.getElementById('firstNameError').textContent = 'First name must be at least 2 characters.';
      valid = false;
    }
    
    // Validate Last Name
    const lastName = document.getElementById('account_lastname');
    if (!lastName.value.trim()) {
      document.getElementById('lastNameError').textContent = 'Last name is required.';
      valid = false;
    } else if (lastName.value.length < 2) {
      document.getElementById('lastNameError').textContent = 'Last name must be at least 2 characters.';
      valid = false;
    }
    
    // Validate Email
    const email = document.getElementById('account_email');
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!email.value.trim()) {
      document.getElementById('emailError').textContent = 'Email is required.';
      valid = false;
    } else if (!emailRegex.test(email.value)) {
      document.getElementById('emailError').textContent = 'Please enter a valid email address.';
      valid = false;
    }
    
    if (!valid) {
      e.preventDefault();
    }
  });
  
  // Password Update Form Validation
  document.getElementById('passwordUpdateForm').addEventListener('submit', function(e) {
    let valid = true;
    
    // Clear previous errors
    document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
    
    // Validate Current Password
    const currentPassword = document.getElementById('account_password');
    if (!currentPassword.value) {
      document.getElementById('currentPasswordError').textContent = 'Current password is required.';
      valid = false;
    }
    
    // Validate New Password
    const newPassword = document.getElementById('account_new_password');
    const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
    if (!newPassword.value) {
      document.getElementById('newPasswordError').textContent = 'New password is required.';
      valid = false;
    } else if (!passwordRegex.test(newPassword.value)) {
      document.getElementById('newPasswordError').textContent = 'Password does not meet requirements.';
      valid = false;
    }
    
    // Validate Confirm Password
    const confirmPassword = document.getElementById('account_confirm_password');
    if (!confirmPassword.value) {
      document.getElementById('confirmPasswordError').textContent = 'Please confirm your new password.';
      valid = false;
    } else if (newPassword.value !== confirmPassword.value) {
      document.getElementById('confirmPasswordError').textContent = 'Passwords do not match.';
      valid = false;
    }
    
    if (!valid) {
      e.preventDefault();
    }
  });
</script>

<%- include('../partials/footer') %>
