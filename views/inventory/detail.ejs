<!-- Reviews Section -->
<div class="reviews-section">
  <h2>Customer Reviews</h2>
  
  <!-- Average Rating -->
  <div class="average-rating">
    <div class="stars">
      <% for(let i = 1; i <= 5; i++) { %>
        <span class="star <%= i <= averageRating ? 'filled' : '' %>">★</span>
      <% } %>
    </div>
    <span class="rating-text"><%= averageRating.toFixed(1) %> out of 5</span>
    <span class="review-count">(<%= reviewCount %> reviews)</span>
  </div>
  
  <!-- Add Review Form (logged in users only) -->
  <% if (loggedin) { %>
    <div class="add-review-form">
      <h3>Write a Review</h3>
      <form action="/reviews/add" method="post">
        <input type="hidden" name="inv_id" value="<%= vehicle.inv_id %>">
        
        <div class="rating-input">
          <label>Your Rating:</label>
          <div class="star-rating">
            <% for(let i = 5; i >= 1; i--) { %>
              <input type="radio" id="star<%= i %>" name="rating" value="<%= i %>" required>
              <label for="star<%= i %>">★</label>
            <% } %>
          </div>
        </div>
        
        <div class="form-group">
          <label for="review_text">Your Review:</label>
          <textarea id="review_text" name="review_text" rows="4" required 
                    minlength="10" maxlength="1000"></textarea>
        </div>
        
        <button type="submit" class="btn">Submit Review</button>
      </form>
    </div>
  <% } else { %>
    <p><a href="/account/login">Log in</a> to write a review.</p>
  <% } %>
  
  <!-- Existing Reviews -->
  <div class="existing-reviews">
    <% if (reviews && reviews.length > 0) { %>
      <% reviews.forEach(function(review) { %>
        <div class="review">
          <div class="review-header">
            <div class="reviewer-name"><%= review.account_firstname %> <%= review.account_lastname %></div>
            <div class="review-date"><%= new Date(review.review_date).toLocaleDateString() %></div>
            <div class="review-rating">
              <% for(let i = 1; i <= 5; i++) { %>
                <span class="star <%= i <= review.rating ? 'filled' : '' %>">★</span>
              <% } %>
            </div>
          </div>
          <div class="review-text"><%= review.review_text %></div>
        </div>
      <% }); %>
    <% } else { %>
      <p class="no-reviews">No reviews yet. Be the first to review this vehicle!</p>
    <% } %>
  </div>
</div>
